import os
import sys
import argparse
import time

from sql_injection_user import NonExistingUser

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='HTTPS-Client Simulation.')
    parser.add_argument('-ip',
                        dest='server_ip',
                        action='store',
                        type=str, required=True,
                        help='The IP address of the target server')
    parser.add_argument('-a',
                        dest='attack',
                        action='store',
                        type=str, required=True,
                        help='Type of attack to be started')
    parser.add_argument('-v',
                        dest='verbose',
                        action='store',
                        type=bool,
                        required=False,
                        default=False,
                        help='Make the operations more talkative')
    args = parser.parse_args()
    if args.verbose:
        print(f"Run attack {args.attack}")

    if args.verbose:
        print("Wait for signal to start attack")
    sys.stdin.readline()
    url = f"http://{args.server_ip}:3000/"
    if args.attack == "SQLInjectionCred":
        if args.verbose:
            print("Start SQLInjectionCred")
        os.system(f'./sql_injection_cred.sh {url}')
    elif args.attack == "SQLInjectionSchema":
        if args.verbose:
            print("Start SQLInjectionSchema")
        os.system(f'./sql_injection_schema.sh {url}')
    elif args.attack == 'SQLInjectionUser':
        if args.verbose:
            print("Start SQLInjectionUser")
        notExistingUser = NonExistingUser(url)
        notExistingUser.run()
    else:
        if args.verbose:
            print("No attack selected")
    if args.verbose:
        print("Done with attack")

    time.sleep(3)
